mysql:
  provides:
    mysql:
      protocol: <<
      host: <<
      private-address: <<
      port: <<
      database: <<
      password: <<
      slave: <<
      user: <<
      
  services:
    mysql:
      charm: "cs:~justin-fathomdb/trusty/mysql"
      num_units: <<
      exposed: true
      options:
        performance: <<
        slow-query-time: <<
        dataset-size: 256M

    stubclient:
      charm: "cs:~justin-fathomdb/trusty/stub-client"
      exposed: true
      options:
        private-port: 3306
        public-port: {{.AssignPublicPort}}
        open-ports: 3306
        protocol: <<

    metrics:
      charm: "cs:~justin-fathomdb/trusty/heka-collector"

  relations:
    - - "stubclient:juju-info"
      - "mysql:juju-info"
    - - "stubclient:mysql"
      - "mysql:db"

    - - "metrics:juju-info"
      - "mysql:juju-info"
    - - "metrics:elasticsearch"
      - "{{.SystemServices.elasticsearch}}:cluster"

    - - "stubclient:website"
      - "{{.SystemServices.haproxy}}:reverseproxy"

  checks:
    service-mysql:
      service: mysql

  meta:
    primary-relation-key: mysql
	
  cloudfoundry:
    properties:
      jdbcUrl: jdbc:mysql://{{.Relations.mysql.user}}:{{.Relations.mysql.password}}@{{.Relations.mysql.host}}:{{.Relations.mysql.port}}/{{.Relations.mysql.database}}
      uri: mysql://{{.Relations.mysql.user}}:{{.Relations.mysql.password}}@{{.Relations.mysql.host}}:{{.Relations.mysql.port}}/{{.Relations.mysql.database}}
      name: {{.Relations.mysql.database}}
      hostname: {{.Relations.mysql.host}}
      port: {{.Relations.mysql.port}}
      username: {{.Relations.mysql.user}}
      password: {{.Relations.mysql.password}}
