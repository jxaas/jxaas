provides:
  mysql:
    protocol: <<
    host: <<
    private-address: <<
    port: <<
    database: <<
    password: <<
    slave: <<
    user: <<

services:
  mysql:
    charm: "cs:~justin-fathomdb/trusty/mysql"
    num_units: <<
    exposed: true
    options:
      performance: <<
      slow-query-time: <<
      dataset-size: 256M

  stubclient:
    charm: "cs:~justin-fathomdb/trusty/stub-client"
    exposed: true
    options:
      private-port: 3306
      public-port: {{.AssignPublicPort}}
      open-ports: 3306
      protocol: <<

  metrics:
    charm: "cs:~justin-fathomdb/trusty/heka-collector"

relations:
  - - "stubclient:juju-info"
    - "mysql:juju-info"
  - - "stubclient:mysql"
    - "mysql:db"

  - - "metrics:juju-info"
    - "mysql:juju-info"
  - - "metrics:elasticsearch"
    - "{{.SystemServices.elasticsearch}}:cluster"

  - - "stubclient:website"
    - "{{.SystemServices.haproxy}}:reverseproxy"

checks:
  service-mysql:
    service: mysql

meta:
  primary-relation-key: mysql

cloudfoundry:
  credentials:
    jdbcUrl: jdbc:mysql://{{.user}}:{{.password}}@{{.host}}:{{.port}}/{{.database}}
    uri: mysql://{{.user}}:{{.password}}@{{.host}}:{{.port}}/{{.database}}
    name: {{.database}}
    hostname: {{.host}}
    port: {{.port}}
    username: {{.user}}
    password: {{.password}}

  plans:
    nano:
      properties:
        dataset-size: 128M
    micro:
      properties:
        dataset-size: 256M
    milli:
      properties:
        dataset-size: 512M
    uni:
      properties:
        dataset-size: 1024M
