## 2 - Proxy Charms


Now, let's demonstrate the proxy charm.  This allows you to consume JXaaS services easily
from within Juju.

For now, we'll run everything within one Juju instance.  To fix this properly requires
exposing everything and getting port forwarding working.  (This more or less works, but is
still a work in progress).
   
```
export JXAAS_URL=http://10.0.3.1:8080/xaas
cat > /tmp/config <<EOF
mp2:
  jxaas-url: ${JXAAS_URL}
  jxaas-authmode: direct
  jxaas-tenant: admin
  jxaas-user: admin
  jxaas-secret: secret
EOF

juju deploy --config=/tmp/config cs:~justin-fathomdb/trusty/mysql-proxy mp2

juju deploy cs:~justin-fathomdb/trusty/mediawiki wiki2

juju status wiki2
juju status mp2

juju add-relation wiki2:db mp2:db
```

If you want to watch progress:

```
sudo tail -f  /var/log/juju-*-local/all-machines.log 
```

The mysql-proxy charm creates a MySQL instance using JXaaS.  You can see the created MySQL instance:

```jxaas list-instances mysql```


The mysql-proxy charm means that you can consume JXaaS easily within Juju.  There is a proxy charm
for each JXaaS service.  Each one automatically connects to JXaaS, creates the appropriate service, and
then provides the configuration details to Juju.  So mediawiki is running in Juju, but consumes 
MySQL delivered from JXaaS.

When this is all ready, you should be able to connect to mediawiki:

```
juju expose wiki2

WIKI_ADDRESS=`juju status wiki2 | grep public-address | cut -f 2 -d ':' | tr -d ' '`
echo "WIKI_ADDRESS=${WIKI_ADDRESS}"
x-www-browser http://${WIKI_ADDRESS}/mediawiki/
```