## 4 - Remote Proxy Charms

This follows on from step #3, where we set up JXaaS on EC2.

Make sure the JXAAS_URL is still set from step #3:

```
echo "Using JXAAS_URL=${JXAAS_URL}"
jxaas list-instances mysql
```

Now, we'll set up a local Juju instance, and consume MySQL-aaS from JXaaS, using the proxy charm.

(This is largely a repetition of what we did in step #2, but using 2 Juju environments, to show
the real power!)

Set up a local Juju:
```
juju generate-config
juju switch local

juju bootstrap

juju status
```

Now, let's demonstrate the proxy charm.  This allows you to consume JXaaS services easily
from within Juju.
   
```
echo "Using JXAAS_URL=${JXAAS_URL}"
cat > /tmp/config <<EOF
mp4:
  jxaas-url: ${JXAAS_URL}
  jxaas-tenant: tenant1
  jxaas-user: user1
  jxaas-secret: secret1
EOF

juju deploy --config=/tmp/config cs:~justin-fathomdb/trusty/mysql-proxy mp4

juju deploy cs:~justin-fathomdb/trusty/mediawiki wiki4

juju status wiki4
juju status mp4

juju add-relation wiki4:db mp4:db
```

If you want to watch progress:

```
sudo tail -f  /var/log/juju-*-local/all-machines.log 
```


When everything has finished:
```
WIKI_ADDRESS=`juju status wiki4 | grep public-address | cut -f 2 -d ':' | tr -d ' '`
echo "WIKI_ADDRESS=${WIKI_ADDRESS}"
x-www-browser http://${WIKI_ADDRESS}/mediawiki/
```

Note that it's very slow, I think that's because
it's not using connection pooling so has to connect to MySQL on every page request (?)


Don't forget to close down your EC2 instances as otherwise you'll wipe out all that money
you saved on the Harry Potter books.

On the EC2 server, run:

```
juju destory-environment amazon
```

That should shut down all the EC2 instances Juju started.  So now you just need to shut down the
instance hosting Juju, and you should be OK!

